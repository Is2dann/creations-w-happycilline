<div class="card h-100">
    <a href="{% url 'products:product_detail' product.slug %}" class="text-decoration-none">
        {% with primary=product.images.all|dictsort:"-is_primary"|first %}
            {% if product.images.all %}
                <!-- try to show first image; "primary" logic handled in view for detail page -->
                <img class="card-img-top" src="{{ product.images.all.0.image.url }}" alt="{{ product.name }}" style="aspect-ratio:1/1;object-fit: cover;">
            {% else %}  
                <div class="bg-light d-flex align-items-center justify-content-center" style="aspect-ratio: 1/1;">
                    <span class="text-muted small">No image</span>
                </div>
            {% endif %}
        {% endwith %}
    </a>
    <div class="card-body">
        <h3 class="h6 card-title">
            <a class="stretched-link text-decoration-none" href="{% url 'products:product_detail' product.slug %}">
                {{ product.name }}
            </a>
        </h3>
        <p class="mb-0">Â£{{ product.price }}</p>
    </div>
</div>